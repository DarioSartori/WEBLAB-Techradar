<div class="toolbar">
  <button (click)="filter = 'all'; load()">All</button>
  <button (click)="filter = 'draft'; load()">Drafts</button>
  <button (click)="filter = 'published'; load()">Published</button>
  <button class="primary" (click)="new()">New</button>
</div>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>Ring</th>
      <th>State</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let t of list">
      <td>{{ t.name }}</td>
      <td>{{ t.category }}</td>
      <td>{{ t.ring || '—' }}</td>
      <td>
        <span
          class="badge"
          [class.draft]="!t.publishedAt"
          [class.published]="t.publishedAt"
        >
          {{ t.publishedAt ? 'Published' : 'Draft' }}
        </span>
      </td>
      <td>
        <button (click)="edit(t)">Edit</button>
        <button *ngIf="!t.publishedAt" (click)="openPublish(t)">Publish</button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Dialog -->
<dialog *ngIf="publishing" class="dialog" open aria-labelledby="publishTitle">
  <button
    type="button"
    class="close-btn"
    (click)="publishing = null"
    aria-label="Close publish dialog"
  >
    ×
  </button>

  <h3 id="publishTitle">Publish: {{ publishing.name }}</h3>

  <label for="ring">Ring</label>
  <select
    id="ring"
    name="ring"
    [(ngModel)]="pub.ring"
    [attr.aria-invalid]="!pub.ring ? true : null"
  >
    <option [ngValue]="''">Please Choose</option>
    <option *ngFor="let r of rings" [ngValue]="r">{{ r }}</option>
  </select>

  <label for="ringDescription">Description</label>
  <textarea
    id="ringDescription"
    name="ringDescription"
    [(ngModel)]="pub.ringDescription"
    [attr.aria-invalid]="!pub.ringDescription ? true : null"
  ></textarea>

  <div class="actions">
    <button (click)="doPublish()" [disabled]="!pub.ring || !pub.ringDescription">
      Publish
    </button>
    <button (click)="publishing = null">Cancel</button>
  </div>
</dialog>
